
PROCESSOR 16F876A
;BANK 0
TMR0 EQU 01H
PCL 	EQU 02H
STATUS EQU 03H
PORTA EQU 05H
PORTB EQU 06H
PORTC EQU 07H
INTCON EQU 0BH

STATUS_TEMP EQU 28H
W_TEMP EQU 29H
INT_CNT EQU 30H

;BANK 1
TRISA EQU 85H
TRISB EQU 86H
TRISC EQU 87H
ADCON1 EQU 9FH
OPTION_REG EQU 81H

;OPTION BITS
W EQU B'0'
F EQU .1
T0IE EQU 5
T0IF EQU 2
GIE EQU 7
ZF EQU 2


;STATUS BITS
RP0 EQU 5

;USER BITS
DBUF1	EQU	20H
DBUF2	EQU	21H


VARIABLE	DISP_1		=	22H
VARIABLE	DISP_10		=	23H
VARIABLE	DISP_100	=	24H
VARIABLE	DISP_1000	=	25H
VARIABLE	LOOP_CNT	=	26H
VARIABLE	KEY_FLAG	=	27H

ORG B'00000000'

GOTO START


ORG 0X04
MOVWF W_TEMP
SWAPF STATUS,W
MOVWF STATUS_TEMP
INCF INT_CNT
MOVF INT_CNT,W
SUBLW .1
BTFSS STATUS,ZF
GOTO RE
GOTO DIS
DIS
CLRF INT_CNT

CALL KEY_CHK
BTFSS KEY_FLAG,1
GOTO INC_LP
GOTO RESET_LOOP
RESET_LOOP
		CLRF		DISP_1
		CLRF		DISP_10
		CLRF		DISP_100
		CLRF		DISP_1000
		GOTO RE
INC_LP
		INCF		DISP_1
		MOVF		DISP_1,W
		SUBLW		.10
		BTFSS		STATUS,ZF
		RETURN
		CLRF		DISP_1
		INCF		DISP_10
		MOVF		DISP_10,W
		SUBLW		.10
		BTFSS		STATUS,ZF
		RETURN
		CLRF		DISP_10
		INCF		DISP_100
		MOVF		DISP_100,W
		SUBLW		.10
		BTFSS		STATUS,ZF
		RETURN
		CLRF		DISP_100
		INCF		DISP_1000
		MOVF		DISP_1000,W
		SUBLW		.10
		BTFSS		STATUS,ZF
		RETURN
		CLRF		DISP_1000
		GOTO RE	

KEY_CHK						
		BTFSS		PORTA,0		; IF(P1 ON)
		CALL		INC_LOOP	; YES
		BTFSS		PORTA,1		; ELSE IF (P2 ON)
		CALL		RE_LOOP	; YES
	
		RETURN					; NO
INC_LOOP
 MOVLW B'00000000'
 MOVWF KEY_FLAG
 RETURN
 RE_LOOP
 MOVLW B'00000010'
 MOVWF KEY_FLAG
 RETURN
RE
CLRF INT_CNT
SWAPF STATUS_TEMP,W
MOVWF STATUS
SWAPF W_TEMP,F
SWAPF W_TEMP,W
BCF INTCON,T0IF
RETFIE
START
BSF STATUS,RP0
MOVLW B'00000000'
MOVWF TRISA
MOVLW 0X07
MOVWF TRISB
MOVLW 0X07
MOVWF TRISC
MOVLW 0X07
MOVWF ADCON1
MOVLW B'00000010'
MOVWF OPTION_REG 
BCF STATUS,RP0
BSF INTCON,GIE
BSF INTCON,T0IE
MOVLW 0X06
MOVWF TMR0
CLRF DISP_1

MAIN
CALL DISPLAY

GOTO MAIN

DISPLAY
		MOVF	DISP_1,W
		CALL	CONV
		MOVWF	PORTC
		BSF		PORTB,0
		CALL	DELAY
		BCF		PORTB,0
	
		MOVF	DISP_10,W
		CALL	CONV
		MOVWF	PORTC
		BSF		PORTB,1
		CALL	DELAY
		BCF		PORTB,1
	
		MOVF	DISP_100,W
		CALL	CONV
		MOVWF	PORTC
		BSF		PORTB,2
		CALL	DELAY
		BCF		PORTB,2
	
		MOVF	DISP_1000,W
		CALL	CONV
		MOVWF	PORTC
		BSF		PORTB,3
		CALL	DELAY
		BCF		PORTB,3
		RETURN
		CONV	
	ANDLW		0FH
	ADDWF		PCL	
	RETLW		0xc0	; '0'
	RETLW		0xf9	; '1'
	RETLW		0xa4	; '2'
	RETLW		0xb0	; '3'
	RETLW		0x99	; '4'
	RETLW		0x92	; '5'
	RETLW		0x83	; '6'
	RETLW		0xf8	; '7'
	RETLW		0x80	; '8'
	RETLW		0x90	; '9'	
	RETLW		0x88	; 'A'
	RETLW		0x83	; 'B'
	RETLW		0xc6	; 'C'
	RETLW		0xa1	; 'D'
	RETLW		0x86	; 'E'
	RETLW		0x8e	; 'F'
		DELAY
	MOVLW	.1
	MOVWF	DBUF1
LP1	MOVLW	.1
	MOVWF	DBUF2
LP2	NOP
	DECFSZ	DBUF2,F
	GOTO	LP2
	DECFSZ	DBUF1,F
	GOTO	LP1
	RETURN


END